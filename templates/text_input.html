<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Text Input — Sentiment AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{--glass-bg:rgba(255,255,255,0.18);--card-border:rgba(255,255,255,0.18);--accent:#aa96da}
        body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#d4a5a5,#a8d8ea,#aa96da);min-height:100vh;padding-top:5rem}
        .glass-shape{position:absolute;border-radius:50%;background:rgba(255,255,255,0.15);backdrop-filter:blur(12px);border:1px solid var(--card-border);z-index:-1}
        .shape-1{width:260px;height:260px;top:-80px;left:-80px}
        .shape-2{width:360px;height:360px;bottom:-120px;right:-120px}
        .main-container{max-width:820px;margin:0 auto;background:rgba(255,255,255,0.22);backdrop-filter:blur(14px);border-radius:20px;padding:2.25rem;border:1px solid var(--card-border);box-shadow:0 8px 32px rgba(31,38,135,0.37)}
        .text-input{width:100%;min-height:160px;padding:1rem;border-radius:12px;border:1px solid rgba(255,255,255,0.3);background:rgba(255,255,255,0.5);color:#2d3436}
        .result{margin-top:1rem}
        .confidence{font-weight:600}
        .nav-right a{margin-left:1rem}
    </style>
</head>
<body>
<div class="glass-shape shape-1"></div>
<div class="glass-shape shape-2"></div>
<nav class="navbar" style="position: fixed; top: 0; left:0; right:0; background: var(--glass-bg); backdrop-filter: blur(10px); border-bottom: 1px solid var(--card-border); box-shadow: 0 4px 16px rgba(0,0,0,0.1); padding: 1rem 2rem; z-index:1000;">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <a href="/" class="navbar-brand" style="display:flex;align-items:center;gap:.75rem;font-weight:600;font-size:1.25rem;color:var(--text-color);text-decoration:none;">
            <i class="fas fa-brain" style="color:var(--accent);"></i>
            Sentiment AI
        </a>
        <div class="nav-links" style="display:flex;gap:1rem;">
            <a href="/user_history" class="nav-link">My History</a>
            {% if session.get('role') == 'admin' %}
            <a href="/admin" class="nav-link">Admin Panel</a>
            {% endif %}
            <a href="/logout" class="nav-link">Logout</a>
        </div>
    </div>
</nav>

<div class="container mt-5">
        <div class="main-container">
        <h3>Text Input</h3>
    <p>Paste or type the text you want analyzed and click <strong>Analyze</strong>.</p>

    <textarea id="inputText" class="text-input" placeholder="Enter English text here..."></textarea>
    <div class="d-flex gap-2 mt-3">
        <button id="analyzeBtn" class="btn btn-primary"><i class="fas fa-brain me-2"></i>Analyze</button>
        <a href="/audio_input" class="btn btn-outline-secondary"><i class="fas fa-file-audio me-2"></i>Use Audio Instead</a>
    </div>

    <div id="resultArea" class="result" style="display:none;">
        <div class="card">
            <div class="card-body">
                <h5 id="prediction" class="card-title"></h5>
                <p id="confidence" class="confidence"></p>
                <div id="analysisDetails" style="margin-top:.5rem;"></div>
            </div>
        </div>
    </div>

    <div id="errorBox" class="mt-3 text-danger" style="display:none;"></div>
</div>

<script>
    async function analyze() {
        const txt = document.getElementById('inputText').value.trim();
        const errorBox = document.getElementById('errorBox');
        errorBox.style.display = 'none';

        if (!txt) {
            errorBox.textContent = 'Please enter some text.';
            errorBox.style.display = 'block';
            return;
        }

        document.getElementById('analyzeBtn').disabled = true;
        document.getElementById('analyzeBtn').textContent = 'Analyzing...';

        try {
            const resp = await fetch('/analyze_text', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: txt, original_urdu: '' })
            });

            if (!resp.ok) throw new Error('Server error ' + resp.status);
            const data = await resp.json();

            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('prediction').textContent = 'Prediction: ' + data.prediction;
            document.getElementById('confidence').innerHTML =
                'Non-suicidal: ' + (data.confidence[0]*100).toFixed(2) + '% — Suicidal: ' + (data.confidence[1]*100).toFixed(2) + '%';

            let details = '';
            if (data.analysis) {
                details += '<p><strong>Words:</strong> ' + data.analysis.word_count + '</p>';
                details += '<p><strong>Text length:</strong> ' + data.analysis.text_length + '</p>';
                details += '<p><strong>First-person count:</strong> ' + data.analysis.first_person_count + '</p>';
                if (data.analysis.indicators && data.analysis.indicators.length) {
                    details += '<p><strong>Indicators:</strong> ' + data.analysis.indicators.join(', ') + '</p>';
                }
            }
            document.getElementById('analysisDetails').innerHTML = details;

        } catch (err) {
            errorBox.textContent = 'Error: ' + err.message;
            errorBox.style.display = 'block';
        } finally {
            document.getElementById('analyzeBtn').disabled = false;
            document.getElementById('analyzeBtn').innerHTML = '<i class="fas fa-brain me-2"></i>Analyze';
        }
    }

    document.getElementById('analyzeBtn').addEventListener('click', analyze);
</script>

</body>
</html>